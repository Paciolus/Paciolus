# =============================================================================
# Paciolus Backend Configuration
# Sprint 24: Production Deployment Prep
# =============================================================================
# Copy this file to .env and configure for your environment.
# NEVER commit .env files to version control!
# =============================================================================

# =============================================================================
# REQUIRED - Application will not start without these
# =============================================================================

# Host address for the API server
# Development: 0.0.0.0 (accepts all connections)
# Production: 0.0.0.0 (let reverse proxy handle security)
API_HOST=0.0.0.0

# Port for the API server
# Development: 8000
# Production: 8000 (container internal port)
API_PORT=8000

# Allowed frontend origins for CORS (comma-separated)
# SECURITY CRITICAL: Never use wildcards (*) in production!
#
# Development:
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
#
# Production (Vercel):
# CORS_ORIGINS=https://paciolus.vercel.app,https://www.paciolus.com
#
# Production (Custom Domain):
# CORS_ORIGINS=https://app.paciolus.com,https://paciolus.com

# =============================================================================
# ENVIRONMENT MODE
# =============================================================================

# Environment mode: development, staging, production
# IMPORTANT: Set to "production" for deployed environments
# Production mode enables:
#   - Strict CORS enforcement
#   - Required JWT_SECRET_KEY validation
#   - Secure cookie settings
#   - Production logging
ENV_MODE=development

# Enable debug mode (detailed error messages)
# WARNING: Never enable in production (exposes sensitive data)
DEBUG=false

# =============================================================================
# AUTHENTICATION (Required for Production)
# =============================================================================

# JWT Secret Key - REQUIRED for production!
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
#
# Security requirements:
#   - Minimum 32 characters
#   - Cryptographically random
#   - Never reuse across environments
#   - Rotate periodically
#
# Leave blank for development (auto-generated, NOT secure for production!)
JWT_SECRET_KEY=

# JWT Algorithm (default: HS256)
# Supported: HS256, HS384, HS512, RS256
JWT_ALGORITHM=HS256

# JWT Token expiration in minutes (default: 30)
# Short-lived access tokens are refreshed silently via refresh tokens
# Development: 1440 (24 hours) for convenience, or 30 to test refresh flow
# Production: 15-60 recommended
JWT_EXPIRATION_MINUTES=30

# Refresh token expiration in days (default: 7)
# Refresh tokens enable short-lived access tokens with seamless renewal
REFRESH_TOKEN_EXPIRATION_DAYS=7

# CSRF Secret Key - REQUIRED for production!
# Used exclusively for HMAC-signing stateless CSRF tokens.
# MUST be different from JWT_SECRET_KEY in production.
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
#
# Leave blank for development (auto-generated, NOT secure for production!)
CSRF_SECRET_KEY=

# =============================================================================
# DATABASE
# =============================================================================

# Database URL
# ZERO-STORAGE NOTE: Database stores ONLY:
#   - User accounts (email, hashed password)
#   - Client metadata (name, industry, fiscal year)
#   - Activity logs (timestamp, action type, hashed filename)
#   - Practice settings (materiality formulas, thresholds)
# Financial data is NEVER persisted.
#
# IMPORTANT: Production mode (ENV_MODE=production) REQUIRES PostgreSQL.
# SQLite is rejected at startup in production — it lacks concurrency,
# WAL durability under crashes, and dialect-portable upsert support.
#
# SQLite (Development only — single file, no setup):
DATABASE_URL=sqlite:///./paciolus.db
#
# PostgreSQL (Production — required):
# DATABASE_URL=postgresql://user:password@localhost:5432/paciolus_db
#
# PostgreSQL (Docker):
# DATABASE_URL=postgresql://paciolus:password@db:5432/paciolus_db
#
# PostgreSQL (Render):
# DATABASE_URL=postgresql://user:password@oregon-postgres.render.com/paciolus_db
#
# PostgreSQL (DigitalOcean):
# DATABASE_URL=postgresql://user:password@db-postgresql-nyc1-12345-do-user-1234.db.ondigitalocean.com:25060/paciolus_db?sslmode=require

# =============================================================================
# CLOUD SECRETS (Optional - Production)
# =============================================================================

# Secrets provider: env (default), aws, gcp, azure
# When set to a cloud provider, secrets_manager.py will attempt to fetch
# credentials from the respective secret management service.
# SECRETS_PROVIDER=env

# AWS Secrets Manager (if SECRETS_PROVIDER=aws)
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key

# Google Cloud Secret Manager (if SECRETS_PROVIDER=gcp)
# GCP_PROJECT_ID=your-project-id
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# Azure Key Vault (if SECRETS_PROVIDER=azure)
# AZURE_VAULT_URL=https://your-vault.vault.azure.net/

# =============================================================================
# DATA RETENTION
# =============================================================================

# Retention window (days) for aggregate metadata tables.
# Records older than this are deleted at startup.
# Applies to: activity_logs, diagnostic_summaries
# Default: 365 (1 year).  Set to 0 to disable cleanup.
# RETENTION_DAYS=365

# =============================================================================
# LOGGING (Production)
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Development: DEBUG or INFO
# Production: INFO or WARNING
# LOG_LEVEL=INFO

# Log format: json (structured) or text (human-readable)
# Production recommendation: json (for log aggregation)
# LOG_FORMAT=json

# =============================================================================
# GUNICORN TUNING (Docker only)
# =============================================================================
# These are only used when running via Docker (Gunicorn CMD in Dockerfile).
# They have no effect when running with `uvicorn main:app` directly.

# Worker count. Formula: (2 * CPU cores) + 1
# 2 cores → 4 workers, 4 cores → 9 workers
# WEB_CONCURRENCY=4

# Worker timeout in seconds — increase for large file uploads/processing
# GUNICORN_TIMEOUT=120

# Graceful shutdown timeout — time to finish in-flight requests before forced kill
# Should be less than GUNICORN_TIMEOUT. Set higher if processing large uploads.
# GUNICORN_GRACEFUL_TIMEOUT=30

# Keep-alive timeout in seconds — set higher than your reverse proxy's keepalive
# (nginx default: 75s, ALB default: 60s)
# GUNICORN_KEEP_ALIVE=5

# Worker recycling — restart workers after N requests to prevent Pandas memory leaks
# Set to 0 to disable. Jitter of 50 is added automatically to avoid thundering herd.
# GUNICORN_MAX_REQUESTS=1000
