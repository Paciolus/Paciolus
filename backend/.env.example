# =============================================================================
# Paciolus Backend Configuration
# Sprint 24: Production Deployment Prep
# =============================================================================
# Copy this file to .env and configure for your environment.
# NEVER commit .env files to version control!
# =============================================================================

# =============================================================================
# REQUIRED - Application will not start without these
# =============================================================================

# Host address for the API server
# Development: 0.0.0.0 (accepts all connections)
# Production: 0.0.0.0 (let reverse proxy handle security)
API_HOST=0.0.0.0

# Port for the API server
# Development: 8000
# Production: 8000 (container internal port)
API_PORT=8000

# Allowed frontend origins for CORS (comma-separated)
# SECURITY CRITICAL: Never use wildcards (*) in production!
#
# Development:
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
#
# Production (Vercel):
# CORS_ORIGINS=https://paciolus.vercel.app,https://www.paciolus.com
#
# Production (Custom Domain):
# CORS_ORIGINS=https://app.paciolus.com,https://paciolus.com

# =============================================================================
# ENVIRONMENT MODE
# =============================================================================

# Environment mode: development, staging, production
# IMPORTANT: Set to "production" for deployed environments
# Production mode enables:
#   - Strict CORS enforcement
#   - Required JWT_SECRET_KEY validation
#   - Secure cookie settings
#   - Production logging
ENV_MODE=development

# Enable debug mode (detailed error messages)
# WARNING: Never enable in production (exposes sensitive data)
DEBUG=false

# =============================================================================
# AUTHENTICATION (Required for Production)
# =============================================================================

# JWT Secret Key - REQUIRED for production!
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
#
# Security requirements:
#   - Minimum 32 characters
#   - Cryptographically random
#   - Never reuse across environments
#   - Rotate periodically
#
# Leave blank for development (auto-generated, NOT secure for production!)
JWT_SECRET_KEY=

# JWT Algorithm is hardcoded to HS256 (not configurable — prevents downgrade attacks)

# JWT Token expiration in minutes (default: 30)
# Short-lived access tokens are refreshed silently via refresh tokens
# Development: 1440 (24 hours) for convenience, or 30 to test refresh flow
# Production: 15-60 recommended
JWT_EXPIRATION_MINUTES=30

# Refresh token expiration in days (default: 7)
# Refresh tokens enable short-lived access tokens with seamless renewal
REFRESH_TOKEN_EXPIRATION_DAYS=7

# CSRF Secret Key - REQUIRED for production!
# Used exclusively for HMAC-signing stateless CSRF tokens.
# MUST be different from JWT_SECRET_KEY in production.
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
#
# Leave blank for development (auto-generated, NOT secure for production!)
CSRF_SECRET_KEY=

# =============================================================================
# PROXY TRUST (Sprint 279)
# =============================================================================

# Comma-separated list of trusted reverse proxy IPs.
# X-Forwarded-For is only honored for rate limiting when the direct
# peer matches one of these IPs. Leave empty to always use peer IP.
# Example: TRUSTED_PROXY_IPS=127.0.0.1,10.0.0.1
# TRUSTED_PROXY_IPS=

# =============================================================================
# DATABASE
# =============================================================================

# Database URL
# ZERO-STORAGE NOTE: Database stores ONLY:
#   - User accounts (email, hashed password)
#   - Client metadata (name, industry, fiscal year)
#   - Activity logs (timestamp, action type, hashed filename)
#   - Practice settings (materiality formulas, thresholds)
# Financial data is NEVER persisted.
#
# IMPORTANT: Production mode (ENV_MODE=production) REQUIRES PostgreSQL.
# SQLite is rejected at startup in production — it lacks concurrency,
# WAL durability under crashes, and dialect-portable upsert support.
#
# SQLite (Development only — single file, no setup):
DATABASE_URL=sqlite:///./paciolus.db
#
# PostgreSQL (Production — required):
# DATABASE_URL=postgresql://user:password@localhost:5432/paciolus_db
#
# PostgreSQL (Docker):
# DATABASE_URL=postgresql://paciolus:password@db:5432/paciolus_db
#
# PostgreSQL (Render):
# DATABASE_URL=postgresql://user:password@oregon-postgres.render.com/paciolus_db
#
# PostgreSQL (DigitalOcean):
# DATABASE_URL=postgresql://user:password@db-postgresql-nyc1-12345-do-user-1234.db.ondigitalocean.com:25060/paciolus_db?sslmode=require

# =============================================================================
# PostgreSQL CONNECTION POOL (Optional — ignored for SQLite)
# =============================================================================
# These tune SQLAlchemy's QueuePool for PostgreSQL.
# Defaults are sensible for 2–4 Gunicorn workers on a single instance.

# Max persistent connections per worker (default: 10)
# DB_POOL_SIZE=10

# Extra connections allowed above pool_size under burst load (default: 20)
# DB_MAX_OVERFLOW=20

# Recycle connections after N seconds to avoid stale TCP (default: 3600)
# DB_POOL_RECYCLE=3600

# =============================================================================
# CLOUD SECRETS (Optional - Production)
# =============================================================================

# Secrets provider: env (default), aws, gcp, azure
# When set to a cloud provider, secrets_manager.py will attempt to fetch
# credentials from the respective secret management service.
# SECRETS_PROVIDER=env

# AWS Secrets Manager (if SECRETS_PROVIDER=aws)
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key

# Google Cloud Secret Manager (if SECRETS_PROVIDER=gcp)
# GCP_PROJECT_ID=your-project-id
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# Azure Key Vault (if SECRETS_PROVIDER=azure)
# AZURE_VAULT_URL=https://your-vault.vault.azure.net/

# =============================================================================
# DATA RETENTION
# =============================================================================

# Retention window (days) for aggregate metadata tables.
# Records older than this are deleted at startup.
# Applies to: activity_logs, diagnostic_summaries
# Default: 365 (1 year).  Set to 0 to disable cleanup.
# RETENTION_DAYS=365

# =============================================================================
# CLEANUP SCHEDULER (Sprint 307 — recurring background cleanup)
# =============================================================================
# Background scheduler runs cleanup jobs on fixed intervals so that
# long-running servers don't accumulate stale tokens or sessions.
# Startup cleanup still runs as a cold-start catch-up regardless.

# Master switch — set to "false" to disable recurring cleanup entirely.
# CLEANUP_SCHEDULER_ENABLED=true

# Interval (minutes) for expired refresh token cleanup (default: 60)
# CLEANUP_REFRESH_TOKEN_INTERVAL_MINUTES=60

# Interval (minutes) for expired verification token cleanup (default: 60)
# CLEANUP_VERIFICATION_TOKEN_INTERVAL_MINUTES=60

# Interval (minutes) for expired tool session cleanup (default: 30)
# CLEANUP_TOOL_SESSION_INTERVAL_MINUTES=30

# Interval (hours) for retention cleanup of activity logs and diagnostic summaries (default: 24)
# CLEANUP_RETENTION_INTERVAL_HOURS=24

# =============================================================================
# STRIPE BILLING (Sprint 363 — optional, disabled by default)
# =============================================================================
# Leave blank to disable Stripe integration. CTAs fall back to "Contact Sales".

# Stripe secret key (sk_test_... or sk_live_...)
# STRIPE_SECRET_KEY=

# Stripe publishable key (pk_test_... or pk_live_...) — passed to frontend
# STRIPE_PUBLISHABLE_KEY=

# Stripe webhook signing secret (whsec_...)
# STRIPE_WEBHOOK_SECRET=

# Stripe Base Plan Price IDs (required when STRIPE_ENABLED)
# Create Products + Prices in Stripe Dashboard, then set the price_* IDs here.
# Each tier needs both monthly and annual Price IDs.
# Startup validation will warn (dev) or fail (production) if any are missing.
# STRIPE_PRICE_SOLO_MONTHLY=price_...
# STRIPE_PRICE_SOLO_ANNUAL=price_...
# STRIPE_PRICE_TEAM_MONTHLY=price_...
# STRIPE_PRICE_TEAM_ANNUAL=price_...
# STRIPE_PRICE_ENTERPRISE_MONTHLY=price_...
# STRIPE_PRICE_ENTERPRISE_ANNUAL=price_...

# Stripe Seat Add-On Price IDs (required for V2 seat-based checkout)
# Graduated pricing in Stripe: seats 1-7 @ $80/mo, seats 8-22 @ $70/mo.
# Only needed when PRICING_V2_ENABLED=true.
# STRIPE_SEAT_PRICE_MONTHLY=price_...
# STRIPE_SEAT_PRICE_ANNUAL=price_...

# Stripe Coupon IDs for promotional pricing (Phase LIX)
# Create in Stripe Dashboard then set IDs here.
# Monthly promo: 20% off first 3 months (duration=repeating, duration_in_months=3, percent_off=20)
# STRIPE_COUPON_MONTHLY_20=
# Annual promo: 10% off first annual invoice (duration=once, percent_off=10)
# STRIPE_COUPON_ANNUAL_10=

# =============================================================================
# ENTITLEMENT ENFORCEMENT (Sprint 363 — tier-based feature gating)
# =============================================================================
# "hard" = block requests exceeding tier limits (default, production)
# "soft" = log warnings only (useful during initial rollout)
# ENTITLEMENT_ENFORCEMENT=hard

# Seat enforcement mode (Phase LIX)
# "soft" = log seat violations but allow (default for 30-day rollout)
# "hard" = block requests when team exceeds seat allocation
# SEAT_ENFORCEMENT_MODE=soft

# Pricing V2 feature flag (Phase LIX)
# "true" = enable hybrid pricing (seat checkout, trial, promo)
# "false" = legacy pricing (default)
# PRICING_V2_ENABLED=false

# =============================================================================
# ANALYTICS (Optional — Sprint 375)
# =============================================================================
# Write key for billing/pricing analytics.
# Leave blank to disable telemetry collection.

# ANALYTICS_WRITE_KEY=

# =============================================================================
# SENTRY APM (Optional — disabled by default)
# =============================================================================
# Error tracking and performance monitoring.
# Leave blank to disable. Zero-Storage: no PII, no request bodies, no replays.

# Sentry DSN — obtain from sentry.io project settings
# SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0

# Fraction of transactions to send for performance monitoring (0.0–1.0)
# SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# LOGGING (Production)
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Development: DEBUG or INFO
# Production: INFO or WARNING
# LOG_LEVEL=INFO

# Log format: json (structured) or text (human-readable)
# Production recommendation: json (for log aggregation)
# LOG_FORMAT=json

# =============================================================================
# GUNICORN TUNING (Docker only)
# =============================================================================
# These are only used when running via Docker (Gunicorn CMD in Dockerfile).
# They have no effect when running with `uvicorn main:app` directly.

# Worker count. Formula: (2 * CPU cores) + 1
# 2 cores → 4 workers, 4 cores → 9 workers
# WEB_CONCURRENCY=4

# Worker timeout in seconds — increase for large file uploads/processing
# GUNICORN_TIMEOUT=120

# Graceful shutdown timeout — time to finish in-flight requests before forced kill
# Should be less than GUNICORN_TIMEOUT. Set higher if processing large uploads.
# GUNICORN_GRACEFUL_TIMEOUT=30

# Keep-alive timeout in seconds — set higher than your reverse proxy's keepalive
# (nginx default: 75s, ALB default: 60s)
# GUNICORN_KEEP_ALIVE=5

# Worker recycling — restart workers after N requests to prevent Pandas memory leaks
# Set to 0 to disable. Jitter of 50 is added automatically to avoid thundering herd.
# GUNICORN_MAX_REQUESTS=1000
